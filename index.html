<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<link REL="SHORTCUT ICON" HREF="shanti.ico">
	<title>SHANTI folio</title>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>	
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<script src="jquery.ui.touch-punch.min.js"></script>
	<script src="ckeditor/ckeditor.js"></script>
	<script src="helpers.js"></script>
	<script src="layout.js"></script>
	<script src="player.js"></script>

	<style type="text/css">
		body { 			font-family:Verdana,Geneva,sans-serif;font-size:12px;
						padding:0px;border:0px;
						}
		.sf-main {		min-width:1024px;
						}
		.sf-menu {		width:100%;height:30px;color:#666;border:2px solid #ddd;
						background-color:#ddd;opacity:inherit;
						border-top-left-radius:6px;border-top-right-radius:6px;
						}
		.sf-body {		width:100%;min-height:300px;color:#666;border:2px solid #ddd;
						background-color:#fff;opacity:inherit;
						}
		.sf-menuItem {	margin-left:50px;cursor:pointer;color:#000;
						}
		.sf-breadItem {	text-align:left;float:right;margin-right:12px;margin-top:8px;
						}
		.sf-lightBox	{ position:absolute;padding:16px;border-radius:6px;z-index:2500;
						background-color:#f8f8f8;font-size:12px;
						}
		.sf-lightBoxTitle { color:#000;font-weight:bold;font-size:18px;
						}
		.sf-is {		border-radius:12px;padding-left:8px;padding-right:8px;padding-top:3px;padding-bottom:2px;
						border:1px solid #ccc;font-size:12px;width:95%;color:#666;
						}
		.sf-bs {		border-radius:16px;padding-left:8px;padding-right:8px;padding-top:1px;color:#666;
						font-size:12px;height:23px;background-color:#e8e8e8;cursor:pointer;border:1px solid #ccc;
						}
		.sf-gallery {  	display:inline-block;text-align:center;width:150px;
						padding-top:0px;padding-bottom:8px;padding-left:12px;padding-right:14px;
						background-color:#ddd;vertical-align:middle;color:#999;
						}
		.sf-galleryContent { overflow-x:hidden;overflow-y:auto;background-color:#f8f8f8;
						border:1px solid #bbb;
						}
		.sf-galleryLab  { padding:8px;border-bottom:1px solid #999;text-align:center;
						height:40px;background-color:#f8f8f8;
						}
		.sf-galleryTool { text-align:left;padding-top:3px;
						}
		.sf-galleryBut  { cursor:pointer;margin-right:25px;
						}
		.sf-projectPage { position:absolute;overflow-x:hidden;overflow-y:auto;top:44px;left:186px;
						width:430px;margin:12px;color:#999;border-right:1px solid #ccc;
						padding-right:16px;margin-right:0px;
						}
		.sf-projectItems { width:440px;text-align:center;color:#aaa;margin-top:-8px;
						}
		.sf-pagePage { 	position:absolute;overflow-x:hidden;overflow-y:auto;top:44px;left:186px;
						width:800px;margin:12px;color:#999;border-right:1px solid #ccc;
						padding-right:16px;margin-right:0px;
						}
		.sf-itemsPicker { position:absolute;overflow-x:hidden;overflow-y:auto;top:44px;left:644px;
						margin:18px;color:#aaa;text-align:left;min-width:160px;margin-top:20px;
						margin-right:0px;
						}
		.sf-item	    { display:inline-block;width:130px;height:64px;padding-bottom:36px;
						text-align:center;margin-right:16px;color:#888;overflow:hidden;
						}
		.sf-pitem	    { display:inline-block;width:130px;height:64px;padding-bottom:36px;
						text-align:center;margin-right:16px;color:#999;overflow:hidden;
						}
		.sf-itemPic    { width:128px;height:64px;border:1px solid #999;cursor:pointer;
						}
		.sf-layoutParams { float:left:width:55%;text-align:left;color:#666;margin:12px;display:inline-block;
						}
		.sf-layoutSizer   { float:right;width:40%;height:400px;cursor:pointer;display:inline-block;
						text-align:left;color:#999;padding-bottom:110px;
						}
		.sf-layoutPcts 	{ width:100%;border:1px solid #999;border-radius:16px;text-align:center;
						padding-top:1px;padding-bottom:1px;margin-bottom:8px;
						}
		.sf-sizerHeader { background-color:#ddd;height:10%;width:100%;border:1px solid #009900;
						}
		.sf-sizerLeft 	{ display:inline-block;background-color:#ddd;height:80%;width:calc(33% - 6px);
						;border:1px solid #ddd;
						}
		.sf-sizerBody 	{ display:inline-block;background-color:#ddd;height:80%;width:calc(33% - 7px);
						border:1px solid #ddd;margin-left:8px;margin-right:8px;
						}
		.sf-sizerRight 	{ display:inline-block;background-color:#ddd;height:80%;width:calc(33% - 6px);
						border:1px solid #ddd;
						}
		.sf-sizerFooter { background-color:#ddd;height:10%;width:100%;border:1px solid #eee;
						}
		.sf-previewTitle { margin-top:8px;margin-bottom:-4px;color:#999;font-weight:bold;
						}
		.unselectable { -moz-user-select: none;     -khtml-user-select: none;
		   			 	-webkit-user-select: none;  -ms-user-select: none;   user-select: none;
		   				}
		.selectable { 	-moz-user-select: text;     -khtml-user-select: text;
		   			 	-webkit-user-select: text;  -ms-user-select: text;   user-select: text;
		   				}
	</style>
</head>
<body>
	<div id="mainDiv" class="sf-main unselectable" style="opacity:0">	
		<div id="menuDiv" class="sf-menu">
			<img src="img/menuheader.png">
			<span style="vertical-align:10px">
				S H A N T l
				<span id="editMenu" class="sf-menuItem" style="margin-left:100px"> Edit</span>
				<span id="projectMenu" class="sf-menuItem"> Portfolios</span>
				<span id="pageMenu" class="sf-menuItem">Pages</span>
				<span id="helpMenu" class="sf-menuItem">Help</span>
				<div id="breadMenu" class="sf-breadItem"><b>Project:</b></div>
			</span>
		</div>
		<div id="bodyDiv" class="sf-body"></div>
	</div>	
<script>

//////////////////////////////////////////////////////////////////////////////////////////////////
// MAIN 
/////////////////////////////////////////////////////////////////////////////////////////////////

var sf=null;															// Holds main folio object									
		
$(window).resize(function() {											// ON WINDOW RESIZE
	if (sf)																	// If loaded
		sf.Draw();															// Redraw to adjust responsivivly
	});
			
$(document).ready(function() {											// ON PAGE LOADED
	isMobile=navigator.userAgent.match(/(ipad|iphone|ipod|android)/i) ? true : false; // Set mobile flag
 	new folio();															// Load main object
	$("#mainDiv").animate({ opacity:1},1000, function() {				
		$("#mainDiv").css("opacity",1);
		});				 
	$("#projectMenu").on("click",function() { 
		sf.page="project";
		Sound("click");												
		sf.Draw();
		});
	$("#pageMenu").on("click",function() { 
		sf.page="page";
		Sound("click");												
		sf.Draw();
		});
	$("#helpMenu").on("click",function() { 
		sf.page="help";
		Sound("click");												
		sf.Draw();
		});
	$("#editMenu").on("click",function() { 
		sf.page="edit";
		Sound("click");												
		sf.Draw();
		});
	});									
		
function folio()														// CONSTRUCTOR
{
	sf=this;																// Point to folio
	this.changed=false;														// No changes yet
	this.itemFilter="";														// No filter
	this.itemType="All types";												// All types
	this.curProject=this.curPage=-1;										// Assume not chosen
	this.queryString=window.location.search.substring(1);					// Get query string
	this.layout=new layout();												// Init layout object
	this.player=new player();												// Init player object
	this.Init("");															// Init folio
	this.page="project";													// Init as project page
	this.Draw();															// Draw 
	}	

folio.prototype.Init=function(data)										// INIT 
{
	this.curProject=0;
	this.firstName="Teresa";
	this.lastName="Sullivan";
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// DRAW
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


folio.prototype.Draw=function()											// DRAW PAGE
{
	var h=window.innerHeight;												// Get height
	var w=window.innerWidth;												// Get width
	$("#bodyDiv").height(h-54);												// Set body height
	this.DrawMenu();														// Set menu
	this.DrawBody();														// Draw body
	this.AddProjectItems();													// Add project items
	$("#projectDiv").height(h-78);											// Set project height
	$("#itemPickerDiv").height(h-90);										// Set picker height
	$("#itemPickerDiv").width(w-$("#projectDiv").width()-$("#galleryDiv").width()-88);				// Set picker width 
	$("#itemPickerDiv").css("left",$("#projectDiv").width()+$("#projectDiv").offset().left+16+"px");	// Set picker left 
}
		
folio.prototype.DrawMenu=function()										// DRAW MENU AREA
{
	$("#editMenu").css("color","#000");										// Reset menu color
	$("#projectMenu").css("color","#000");									// Reset
	$("#pageMenu").css("color","#000");										// Reset
	$("#helpMenu").css("color","#000");										// Reset
	var str="<b>"+this.firstName+" "+this.lastName+"</b>";					// Add name
	if (this.page == "project")	{											// If project
		$("#projectMenu").css("color","#00aa00");							// Highlight it
		str+=" &nbsp;|&nbsp; ";												// Add to breadcrumb
		if ((this.curProject != -1) && projects[this.curProject].title)		// A valid project
			str+=ShortenString(projects[this.curProject].title,20);			// Add title
		}
	else if (this.page == "page") {											// If page
		$("#pageMenu").css("color","#00aa00");								// Highlight it
		str+="&nbsp;|&nbsp; ";												// Add to breadcrumb
		if ((this.curProject != -1) && projects[this.curProject].title)		// A valid project
			str+=ShortenString(projects[this.curProject].title,20);			// Add title
		str+=" &nbsp;|&nbsp; 1";											// Add to breadcrumb
		}
	else if (this.page == "help") 											// If help
		$("#helpMenu").css("color","#00aa00");								// Highlight it
	$("#breadMenu").html(str);												// Set breadcrumb
}

folio.prototype.DrawBody=function()										// DRAW BODY AREA
{
	var str="";
	if (this.page == "project") {											// If a project
		str+=this.MakeGallery();											// Add Gallery
		str+=this.MakeProjectPage();										// Add project page
		str+="<div id='itemPickerDiv' class='sf-itemsPicker'></div>";		// Item picker container
		}
	else if (this.page == "page") {											// If page
		str+=this.MakeGallery();											// Add Gallery
		str+=this.MakePagePage();											// Add page page
		str+="<div id='itemPickerDiv' class='sf-itemsPicker'></div>";		// Item picker container
		}
	else if (this.page == "help") {											// If help
		str+="<div id='projectDiv' class='sf-projectPage' style='left:0px;width:50%;min-width:500px'>";	// Project container
		str+="<iframe frameborder='0' height='"+(window.innerHeight-90)+"' width='100%' src='";
		str+="//docs.google.com/document/d/1IEtDo0jMhtaVyFeewcB_UXHWirO2Al_jO6Ri7u1QYoI/pub?embedded=true'/></div>";
		}
	else if (this.page == "edit") {											// If edit
		str+="<div id='projectDiv' class='sf-projectPage' style='left:0px;width:50%;min-width:500px'>";	// Project container
		}
	$("#bodyDiv").html(str);												// Fill body
	
	if (this.page == "project")	{											// If a project
 		if (this.curProject < 0)											// If not a valid project										
 				return;														// Quit
		this.AddProjectItems(true);											// Add project items
		
		$("#pTitle").on("change",function() { 								// If changed
			projects[sf.curProject].title=$("#pTitle").val();				// Set it	
			sf.Do()															// Something changed
			});
		
		$("#pDesc").on("change",function() { 								// If changed
			projects[sf.curProject].desc=$("#pDesc").val();					// Set it	
			sf.Do()															// Something changed
			});
		
		$("#pCite").on("change",function() { 								// If changed
			projects[sf.curProject].cite=$("#pCite").val();					// Set it	
			sf.Do()															// Something changed
			});
		
		$("#pTags").on("change",function() { 								// If changed
			projects[sf.curProject].tags=$("#pTags").val();					// Set it	
			sf.Do()															// Something changed
			});
		
		$("#pFormat").on("change",function() { 								// If changed
			projects[sf.curProject].format=$("#pFormat").val();				// Set it	
			Sound("click");													// Click
			sf.Do()															// Something changed
			sf.Draw();														// Redraw
			});

		for (i=0;i<projects.length;++i)										// For each project
			$("#galleryLab"+i).on("click", function(e) {					// ON PROJECT CLICK
				sf.curProject=e.currentTarget.id.substr(10)-0;				// Extract id
				Sound("click");												// Click
				sf.Draw();													// Redraw
				});

		$("#pFilter").on("change",function() { 								// If changed
			sf.itemFilter=$("#pFilter").val();								// Set it	
			sf.Draw();														// Redraw
			});
	
		$("#pType").on("change",function() { 								// If changed
			sf.itemType=$("#pType").val();									// Set it	
			sf.Draw();														// Redraw
			});

		$("#galleryAddBut").on("click",function() { 						// ADD NEW PROJECT
			projects.push({ title:"New project", items:[] });				// Add shell					
			sf.curProject=projects.length-1;								// Point at it
			Sound("add");													// Add
			sf.Do()															// Something changed
			sf.Draw();														// Redraw
			});
		
		$("#galleryCopyBut").on("click",function() { 						// COPY A PROJECT
 			if (sf.curProject < 0)											// If not a valid project										
 				return;														// Quit
 			GetTextBox("Type project name", "This is the name of the new project made from the current one", "", function(s) {	// Ask for name
				var o=JSON.stringify(projects[sf.curProject]);				// Deep copy current project as JSON
				projects.push($.parseJSON(o));								// Add copy as object					
				sf.curProject=projects.length-1;							// Point at it
				projects[projects.length-1].title=s;						// Change title
				Sound("add");												// Add
				sf.Do()														// Something changed
				sf.Draw();													// Redraw
				});
			});
		
		$("#galleryTrashBut").on("click",function() { 						// DELETE PROJECT
 			if (sf.curProject < 0)											// If not a valid project										
 				return;														// Quit
			ConfirmBox("This will delete the project:<br><br><b><i>"+projects[sf.curProject].title+"</b></i>", function() {
				projects.splice(sf.curProject,1);							// Remove it
				sf.curProject--;											// Go to previous projcet
				Sound("delete");											// Delete
				sf.Do()														// Something changed
				sf.Draw();													// Redraw
				});
			});

		$("#collabAddBut").on("click",function() { 							// ADD NEW COLLABORATOR
 			GetTextBox("Type name of collaborator", "", "", function(s) {	// Ask for name
				if (projects[sf.curProject].collab)							// If not first one
					projects[sf.curProject].collab+=","+s;					// Add new collaborator
				else														// Frist one one
					projects[sf.curProject].collab=s;						// Add first collaborator
				Sound("add");												// Add
				sf.Do()														// Something changed
				sf.Draw();													// Redraw
				$("#pCollab").val(s);
			});
		});

		$("#collabTrashBut").on("click",function() { 						// DELETE PROJECT
				var s=$("#pCollab").val();
				if (!s)														// Nothing selected
					return;													// Quit
			ConfirmBox("This will delete <b>"+s+" </b>from the project", function() {
				var v=projects[sf.curProject].collab.split(",");			// Make into array		
				v.splice($("#pCollab").prop('selectedIndex'),1);			// Delete it
				projects[sf.curProject].collab=v.toString();				// Combine into string
				Sound("delete");											// Delete
				sf.Do()														// Something changed
				sf.Draw();													// Redraw
				});
			});

		$("#projectDiv").droppable({
			 drop: function(event, ui) {									// On drop
				if (ui.draggable.prop("id").substr(0,5)== "item-") {		// From items corpus
			 		projects[sf.curProject].items.push(ui.draggable.prop("id").substr(5));	// Add to items
					Sound("add");											// Add
					sf.Do()													// Something changed
					sf.AddProjectItems();									// Add project items
					}
				}
			 });
		
		$("#addPages").on("click",function() { 								// ADD PAGES
 			var str="This will add a page for each item in the project, in the order they are in now."
 			str+="You can reorder and edit them in the Page editor.<br><br>";
 			str+="<b>NOTE: </b>This will remove any pages you already have made by hand."
 			ConfirmBox(str, function() {									// Confirm it
				sf.AddPages();												// Add pages
				Sound("ding");												// Ding
				sf.page="page";												// Set for page
				sf.Do()														// Something changed
				sf.Draw();													// Redraw
				});
			});

		$("#editPages").on("click",function() { 							// CREATE PAGES
 			sf.page="page";													// Set for page
 			Sound("click");													// Click
			sf.Draw();														// Redraw
			});

		$("#setLayout").on("click",function() { 							// SET LAYOUT
			sf.Do()															// Something changed
 			sf.layout.Set();												// Set layout
 			});
		}
}	


folio.prototype.MakeGallery=function()									// MAKE GALLERY 
{
	var i,o,n=0;labs=[];
	var h=$("#bodyDiv").height()-60;										// Get height											
	var trsty=" onMouseOver='this.style.backgroundColor=\"#dee7f1\"' ";		// Hover style
	trsty+="onMouseOut='this.style.backgroundColor=\"#f8f8f8\"'";
	var title=(this.page == "project") ? "Portfolios" : "Pages";			// Set title
	var str="<div id='galleryDiv' class='sf-gallery'><p><b>"+title+"</b></p>";	// Make gallery div
	str+="<div class='sf-galleryContent' style='height:"+(h-20)+"px'>";		// Scrollable container

	if (this.page == "project") {											// Project gallery
		if (!projects.length)												// No projects yet
			str+="<br>Add a new project by clicking on the + icon below";	// Say so
		for (i=0;i<projects.length;++i) {									// For each project
			labs[i]=projects[i].title;										// Set label
			str+="<div id='galleryLab"+i+"'"+trsty+" class='sf-galleryLab'><span";
			if (i == this.curProject)										// If the current project
				str+=" style='color:#009900'"								// Color it
			str+=">"+labs[i]+"</span></div>";								// Close
			}
		}
	else if (this.page == "page") {											// Page gallery
		if (this.curProject == -1) {										// No project selected yet
			str+="<br><br>Sorry, there is no portfolio selected yet.";		// Warn
			str+="<br><br>Go back to portfolios<br>and add one.";						
			return str+"</div>";											// Quit
			}
		o=projects[this.curProject].pages;									// Point at pages
		if (o)
			n=o.length;
		for (i=0;i<n;++i) {													// For each page
			str+="<div id='galleryLab"+i+"'"+trsty+" class='sf-galleryLab'><span";
			if (i == this.curPage)											// If the current project
				str+=" style='color:#009900'"								// Color it
			str+=">Page"+(i+1)+"</span></div>";								// Close
			}
		}
	str+="</div>";
	str+="<div style='position:relative;text-align:center;margin-top:8px'></div>";
	str+="<div class='sf-galleryTool'>";
	str+="<img id='galleryAddBut' class='sf-galleryBut' src='img/addbut.gif' title='Add new project'>";
	str+="<img id='galleryCopyBut' class='sf-galleryBut'src='img/copybut.gif'  title='Copy a project'>";
	str+="<img id='gallerySettingsBut' class='sf-galleryBut' src='img/settingsbut.gif' title='Project settings'>";
	str+="<img id='galleryTrashBut' class='sf-galleryBut' src='img/trashbut.gif' style='margin-right:0px' title='Remove a project'>";
	str+="</div>";
	return str;																// Return gallery
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// PROJECTS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	
folio.prototype.MakeProjectPage=function()								// MAKE PROJECT PAGE
{
	var i;
	var pTitle="",pDesc="",pCite="",pTags="",pCollab=[],pFormat="Booklet";
	var str="<div id='projectDiv' class='sf-projectPage'>";					// Project container
	if (this.curProject < 0) 												// No project selected
		return str+"</div>";												// Return empty page
	if (projects[this.curProject].title)  	pTitle=projects[this.curProject].title;
	if (projects[this.curProject].desc)   	pDesc=projects[this.curProject].desc;
	if (projects[this.curProject].cite)   	pCite=projects[this.curProject].cite;
	if (projects[this.curProject].tags)   	pTags=projects[this.curProject].tags;
	if (projects[this.curProject].format)   pFormat=projects[this.curProject].format;
	if (projects[this.curProject].collab) 	pCollab=projects[this.curProject].collab.split(",");
	str+="<table style='width:100%;font-weight:bold;text-align:left'>";
	str+="<tr height='32'><td width='1%'>Title</td>";
	str+="<td><input class='sf-is' id='pTitle' ";
	str+="type='text' value='"+pTitle+"'></td></tr>";
	str+="<tr height='28'><td>Description</td><td><textarea class='sf-is' id='pDesc' ";
	str+="style='font-family:sans-serif'>"+pDesc+"</textarea></td></tr>";
	str+="<tr height='28'><td>Citation</td>";
	str+="<td><input class='sf-is' id='pCite' ";
	str+="type='text' value='"+pCite+"'></td></tr>";
	str+="<tr height='28'><td>Tags</td>";
	str+="<td><input class='sf-is' id='pTags' type='text' value='"+pTags+"'></td></tr>";
	str+="<tr height='28'><td>Collaborators&nbsp;&nbsp;&nbsp;</td>";
	str+="<td>"+MakeSelect("pCollab",false,pCollab);
	str+="<img id='collabAddBut' class='sf-galleryBut' src='img/addbut.gif' style='vertical-align:-4px;margin-left:20px;margin-right:10px' title='Add new collaborator'>";
	str+="<img id='collabTrashBut' class='sf-galleryBut' src='img/trashbut.gif' style='vertical-align:-4px;margin-right:0px' title='Remove a collaborator'></td></tr>";
	str+="<tr height='28'><td>Format style</td><td>";
	str+=MakeSelect("pFormat",false,["Booklet","SinglePage","Canvas","Slideshow"],pFormat)+"</td></tr>";
	str+="<tr height='50'><td colspan='2' style='text-align:center'>";
	str+="<button class='sf-bs' style='width:100px' id='addPages'>Add pages</button>&nbsp; &nbsp;";		// Add pages button
	str+="<button class='sf-bs' style='width:100px' id='setLayout'>Set layout</button>&nbsp; &nbsp;";	// Set layout button
	str+="<button class='sf-bs' style='width:100px' id='editPages'>Edit pages</button></td></tr>";		// View pages button
	str+="</table>";
	str+="<div id='projectItemsDiv' class='sf-projectItems'></div>";		// Items div
	return str+"</div>";													// Return project page
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// PAGES
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


folio.prototype.MakePagePage=function()									// MAKE PAGE PAGE
{
	var str="<div id='projectDiv' class='sf-pagePage'>";					// Project container
	str+="<p style='text-align:center'>This is where pages are edited</p>";
	if (this.curProject < 0) 												// No project selected
		return str+"</div>";												// Return empty page
	return str+"</div>";													// Return oage page
}

folio.prototype.AddPages=function()										// ADD PAGES TO PROJECT
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// ITEMS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


folio.prototype.PreviewItem=function(id)								// PREVIEW ITEM
{
	var str="<div class='sf-previewTitle'>"+items[id].title+"</div><br>";
	var h=window.innerHeight-350;
	str+="<iframe frameborder='0' height='"+h+"' width='100%' style='opacity:0,border:1px solid #666' src='"+items[id].src+"'/>";
	ShowLightBox(500,"Preview",str);
}
	
folio.prototype.AddProjectItems=function(showAll)						// ADD ITEMS
{
	var o,i,n,lab,pic,str,div;
	var fil="",typ="all types";
	if ((this.page == "project") || (this.page == "page")) {				// If filling project items
		if (this.curProject < 0)											// No project												
			return;															// Quit
		n=projects[this.curProject].items.length;							// Number of items
		}
	if (showAll) {
		typ=this.itemType.toLowerCase();									// Type as lc
		fil=this.itemFilter.toLowerCase();									// Filter as lc
		div="itemPickerDiv";												// Point at item picker
		str="<div style='text-align:center'>Show only&nbsp;";			
		str+=MakeSelect("pType",false,["All types","Web","Image","Map","Media","WordPress","Mandala","SHIVA","Qmedia","VisualEyes"],this.itemType);
		str+="&nbsp; filtered&nbsp;by&nbsp;&nbsp;<input type='text' class='sf-is' id='pFilter' value='"+this.itemFilter+"' style='width:80px'> &nbsp;";
		str+="</div><br>"; 
		n=items.length;														// Number of items
		}
	else if (this.page == "project") {										// Project page
		div="projectItemsDiv";												// Point at project items
		str="<p style='text-align:center'>Drag items to include in project here</p>";
		}
	else if (this.page == "page") {											// Page page
		div="itemPickerDiv";												// Point at item picker
		str="<p style='text-align:center'>Project items to use in pages</p>";
		}
	for (i=0;i<n;++i) {														// For each item
		if (typ != "all types")												// If filtering by type
			if (items[i].type != typ)										// Not the right one
				continue;													// Skip it
		if (fil) {															// If filtering by text
			lab=items[i].title+items[i].desc+items[i].citation+items[i].tags;	// Get certain fields
			if (lab.toLowerCase().indexOf(fil) == -1) 						// If not in there
				continue;													// Skip it
			}
		if (showAll) {														// Showing all items
			o=items[i];														// Point at items directly
			str+="<div id='item-"+i+"' class='sf-item'>";					// Add item container for items
			}
		else{																// Show only project items
			o=items[projects[this.curProject].items[i]];					// Point at item via project
			str+="<div id='pitem-"+i+"' class='sf-pitem'>";					// Add item container for pitems
			}
		if (o.title)														// If a title
			lab=ShortenString(o.title,35);									// Add it
		if (o.thumb)														// If a thumb
			pic=o.thumb;													// Add it
		else{																// Use generic images
			pic="img/";														// Add folder
			switch (o.type) {												// Route on type
				case 	"media": 		pic+="mediaitem"; 			break;	// Set
				case 	"qmedia": 		pic+="qmediaitem"; 			break;			
				case 	"image": 		pic+="imageitem"; 			break;			
				case 	"pdf": 			pic+="pdfitem"; 			break;			
				case 	"map": 			pic+="mapitem"; 			break;			
				case 	"shiva": 		pic+="shivaitem"; 			break;			
				case 	"visualeyes": 	pic+="veitem"; 				break;			
				case 	"mandala": 		pic+="mandalaitem"; 		break;			
				case 	"wordpress": 	pic+="wordpressitem"; 		break;			
				default: 				pic+="webitem"; 			break;	// All others use web pic
				}
			pic+=".png";													// Add ext
			}	
		str+="<img src='"+pic+"' class='sf-itemPic'>"+lab+"</div>";			// Add pic	
		}
	$("#"+div).html(str);													// Add items to div
	
	if ((this.page == "project") || (this.page == "page")) 					// If filling project items
		for (i=0;i<n;++i) {													// For each item in project
			$("#pitem-"+i).draggable({ 										// Make item draggable
				helper:'clone',appendTo:'body',			 					// Beyond parent frame
				stop: function(e, ui) {										// On stop dragging
					if ((sf.page == "project") && ((ui.position.left > 600) || (ui.position.left < 100))) {	// Out of project items box
				 		projects[sf.curProject].items.splice(e.target.id.substr(6),1);	// Remove it
						Sound("delete");									// Delete
						sf.Do()												// Something changed
						sf.AddProjectItems();								// Add project items
						}
					}
				});
				
			$("#pitem-"+i).droppable({ 										// Make item droppable
				 accept: ".sf-pitem",										// Accept only project items
				 drop: function(event, ui) {								// On drop
					var from=ui.draggable.prop('id').substr(6);				// Get id of dragged item
					var to=$(event.target).prop('id').substr(6);			// Get id of receiver item
					if (sf.page == "project") {								// Project
						var o=projects[sf.curProject].items;				// Point at items
						var t=o[to];										// Save to item
						o[to]=o[from];										// Copy from -> to
						o[from]=t;											// Reset to
						Sound("click");										// Click
						sf.Do()												// Something changed
						sf.AddProjectItems();								// Add project items
						}
					}
				 });

			$("#pitem-"+i).on("dblclick",function() {						// ON DOUBLE CLICK
				var id=$(this).prop("id").substr(6);						// Get id of project item
					sf.PreviewItem(projects[sf.curProject].items[id]);		// Preview		
				});

			$("#pitem-"+i).on("doubletap",function() {						// ON DOUBLE CLICK MOBILE
				var id=$(this).prop("id").substr(6);						// Get id of project item
					sf.PreviewItem(projects[sf.curProject].items[id]);		// Preview		
				});
			}

		if (showAll) {														// Showing all items
			for (i=0;i<n;++i) {												// For each item
				
				$("#item-"+i).on("dblclick",function() {					// ON DOUBLE CLICK
					sf.PreviewItem($(this).prop("id").substr(5));			// Preview		
					});
				$("#item-"+i).on("doubletap",function() {					// ON DOUBLE CLICK MOBILE
					sf.PreviewItem($(this).prop("id").substr(5));			// Preview		
					});
				
				$("#item-"+i).draggable({ 									// Make item draggable
					helper:'clone',appendTo:'body'			 				// Beyond parent frame
					});
				}
			}
}	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// UNDO
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

folio.prototype.Do=function()											// DO
{
	this.changed=true;														// Set change flag
}
	
		
</script>
</body>
</html>
	
