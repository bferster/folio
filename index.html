<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<link REL="SHORTCUT ICON" HREF="shanti.ico">
	<title>SHANTI folio</title>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>	
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<script src="jquery.ui.touch-punch.min.js"></script>
	<script src="ckeditor/ckeditor.js"></script>
	<script src="helpers.js"></script>
	<script src="layout.js"></script>
	<script src="share.js"></script>
	<script src="collect.js"></script>
	<script src="player.js"></script>
	<script src="template.js"></script>
	<script src="item.js"></script>

	<style type="text/css">
		body { 			font-family:Verdana,Geneva,sans-serif;font-size:12px;
						padding:0px;border:0px;margin:8px;
						}
		.sf-splash { 	text-align:center;position:absolute;top:200px;left:calc(50% - 240px);
						}
		.sf-main {		min-width:1024px;margin:0px;padding:0px;box-sizing:border-box;
						}
		.sf-menu {		width:100%;height:32px;color:#666;
						background-color:#ddd;opacity:inherit;
						border-top-left-radius:6px;border-top-right-radius:6px;
						}
		.sf-body {		width:100%;min-height:300px;color:#666;border:2px solid #ddd;	
						background-color:#fff;opacity:inherit;box-sizing:border-box;
						}
		.sf-menuItem {	margin-left:50px;cursor:pointer;color:#000;
						}
		.sf-breadItem {	text-align:left;float:right;margin-right:12px;margin-top:8px;
						}
		.sf-gallery {  	display:inline-block;text-align:center;width:150px;
						padding-top:0px;padding-bottom:8px;padding-left:12px;padding-right:14px;
						background-color:#ddd;color:#999;
						}
		.sf-galleryContent { overflow-x:hidden;overflow-y:auto;background-color:#f8f8f8;
						border:1px solid #bbb;
						}
		.sf-galleryLab  { padding:8px;border-bottom:1px solid #999;text-align:center;
						height:40px;background-color:#f8f8f8;
						}
		.sf-galleryTool { text-align:left;padding-top:3px;
						}
		.sf-galleryBut  { cursor:pointer;margin-right:46px;
						}
		.sf-projectPage { display:inline-block;overflow-x:hidden;overflow-y:auto;
						width:430px;color:#999;border-right:1px solid #ccc;
						padding-right:16px;margin:16px;vertical-align:top;
						}
		.sf-projectItems { width:440px;text-align:center;color:#aaa;margin-top:-16px;
						}
		.sf-itemsPicker { position:absolute;overflow-x:hidden;overflow-y:auto;top:42px;left:644px;
						margin:18px;color:#aaa;text-align:left;min-width:160px;margin-top:20px;
						margin-right:0px;
						}
		.sf-item, .sf-pitem	{ display:inline-block;width:130px;height:64px;padding-bottom:40px;
						text-align:center;margin-right:16px;color:#888;overflow:hidden;vertical-align:top;
						}
		.sf-itemPic    { width:128px;height:64px;border:1px solid #999;cursor:pointer;
						}
		.sf-player { 	height:calc(100% - 42px);width:100%;color:#000;
						}
		.sf-playerPane{	display:inline-block;box-sizing:border-box;background-color:#eeeeee;
						overflow:hidden;padding:8px;
						}
		.sf-layoutParams { display:inline-block;width:50%;text-align:left;color:#888;margin:12px;
						display:inline-block;margin-right:24px;
						}
		.sf-layoutSizer { display:inline-block;width:calc(50% - 55px);height:400px;cursor:pointer;
						text-align:left;color:#999;margin-bottom:20px;margin-right:16px;vertical-align:top;
						}
		.sf-layoutPcts 	{ border:1px solid #999;border-radius:16px;padding:2px;color:#666;
						}
		.sf-sizerTop { 	box-sizing:border-box;overflow:hidden;;margin:1px;
						background-color:#ddd;text-align:center;
						}
		.sf-sizerLeft { display:inline-block;box-sizing:border-box;margin:1px;overflow:hidden;
						background-color:#ddd;text-align:center;
						}
		.sf-sizerMid { 	display:inline-block;box-sizing:border-box;margin:1px;overflow:hidden;
						background-color:#ddd;text-align:center;
						}
		.sf-sizerRight { display:inline-block;box-sizing:border-box;margin:1px;overflow:hidden;
						background-color:#ddd;text-align:center;
						}
		.sf-sizerBot { 	box-sizing:border-box;overflow:hidden;;margin:1px;
						background-color:#ddd;text-align:center;
						}
		.sf-previewTitle { margin-top:8px;margin-bottom:-4px;color:#999;font-weight:bold;
						}
		.sf-pullDown {	position:absolute;background-color:#ddd;width:100px; 
						}
		.sf-itemBut  { 	cursor:pointer;margin-right:20px;vertical-align:-4px;
						}
		.sf-pullDownItem {	padding-bottom:6px;cursor:pointer;width:92px;padding:6px;
						padding-left:8px;padding-right:0px;
						}
		.sf-pullDownItem:hover{ background-color:#bbb;color:#eee
						}
		.sf-lightBox	{ position:absolute;padding:16px;border-radius:6px;z-index:2500;
						background-color:#f8f8f8;font-size:12px;
						}
		.sf-lightBoxTitle { color:#666;font-weight:bold;font-size:18px;
						}
		.sf-is {		border-radius:12px;padding-left:8px;padding-right:8px;padding-top:3px;padding-bottom:2px;
						border:1px solid #ccc;font-size:12px;width:95%;color:#666;
						}
		.sf-bs {		border-radius:16px;padding-left:8px;padding-right:8px;padding-top:1px;color:#666;
						font-size:12px;height:23px;background-color:#e8e8e8;cursor:pointer;border:1px solid #ccc;
						}
		.unselectable { -moz-user-select: none;     -khtml-user-select: none;
		   			 	-webkit-user-select: none;  -ms-user-select: none;   user-select: none;
		   				}
		.selectable { 	-moz-user-select: text;     -khtml-user-select: text;
		   			 	-webkit-user-select: text;  -ms-user-select: text;   user-select: text;
		   				}
	</style>
</head>
<body>
	<div id="splashDiv" class="sf-splash"><img src="flogo.png"></div>
	<div id="mainDiv" class="sf-main unselectable" style="opacity:0">	
		<div id="menuDiv" class="sf-menu" >
			<img src="img/menuheader.png">
			<span style="vertical-align:10px">
				S H A N T l
				<span style="margin-left:100px"></span>
				<span id="editMenu" class="sf-menuItem" style="margin-left:100px">Edit</span>
				<span id="itemMenu" class="sf-menuItem"> Items</span>
				<span id="projectMenu" class="sf-menuItem"> Portfolios</span>
				<span id="pageMenu" class="sf-menuItem">Pages</span>
				<span id="helpMenu" class="sf-menuItem">Help</span>
				<div id="breadMenu" class="sf-breadItem"><b>Portfolio:</b></div>
			</span>
		</div>
		<div id="bodyDiv" class="sf-body"></div>
	</div>	
<script>

//////////////////////////////////////////////////////////////////////////////////////////////////
// MAIN 
/////////////////////////////////////////////////////////////////////////////////////////////////

var sf=null;																// Holds main folio object	
var curProject=-1,curPage=-1,curItem=-1,curTemplate=0;						// Keeps tabs on current places	
var playerObj=null,layoutObj=null,collectObj=null;							// Objects							
var tempObj=null,shareObj=null,itemObj=null;
var projObj=null,pageObj=null;												// TBD
var isMobile=false;															// Is it mobile?
var changed=false;															// Anything changed?
var itemType="All types",itemFilter="";										// Filtering
var curMenu="project";														// Current menu item
var editMode=false;
		
$(window).resize(function() {											// ON WINDOW RESIZE
	if (sf)																	// If loaded
		sf.Draw();															// Redraw to adjust responsivivly
	});
			
$(document).ready(function() {											// ON PAGE LOADED
	isMobile=navigator.userAgent.match(/(ipad|iphone|ipod|android)/i) ? true : false; // Set mobile flag
	itemObj=new item();														// Load item object
 	tempObj=new template();													// Load template object
	shareObj=new share();													// Load layout object
	layoutObj=new layout();													// Load share object
	playerObj=new player();													// Load player object
 	sf=new folio();															// Load main object

	$("#splashDiv").animate({ opacity:0},1000, function(){					// Hide logo
		$("#splashDiv").css("visibility","hidden");							
		});								
	$("#mainDiv").animate({ opacity:1},2000, function() {					// Animate in content		
		$("#mainDiv").css("opacity",1);
		});				 
	
	$("#itemMenu").on("click",function() { 
		curMenu="item";
		Sound("click");												
		sf.Draw();
		});
	$("#projectMenu").on("click",function() { 
		curMenu="project";
		Sound("click");												
		sf.Draw();
		});
	$("#pageMenu").on("click",function() { 
		curMenu="page";
		Sound("click");												
		sf.Draw();
		});
	$("#helpMenu").on("click",function() { 
		curMenu="help";
		Sound("click");												
		sf.Draw();
		});
	$("#editMenu").on("click",function(e) { 
		var l=$(this).position().left+92;
		var t=$(this).position().top+23;
		$("#editMenu").css("color","#009900");										
		$("#editDiv").remove();
		var str="<div class='sf-pullDown' style='left:"+l+"px;top:"+t+"px' id='editDiv'>";
		str+="<div class='sf-pullDownItem' onclick=''>Copy</div>";
		str+="<div class='sf-pullDownItem' onclick=''> Paste</div>";
		str+="<div class='sf-pullDownItem' onclick=''> Undo</div>";
		str+="<div class='sf-pullDownItem' onclick=''> Redo</div>";
		str+="</div>";
		$("body").append(str);
	
		$("#editDiv").on("mouseleave",function() { 
			$("#editDiv").remove();
			$("#editMenu").css("color","#000");										
			});
		
		$("#editDiv").on("click",function(e) { 
			var i=Math.floor(Math.max(0,Math.min((e.clientY-42)/24,4)));
			$("#editDiv").remove();
			$("#editMenu").css("color","#000");	
			});
	
		});
	
	});									
		
function folio()														// CONSTRUCTOR
{
	sf=this;																// Point to folio
	this.projects=[];														// Holds project
	this.items=[];															// Holds items
	this.Init("");															// Init folio
	this.Draw();															// Draw 
	}	

folio.prototype.Init=function(data)										// INIT 
{
	var i;
	
	this.projects=projects;													// REPLACE!!
	this.items=items;
	this.firstName="Teresa";
	this.lastName="Sullivan";
	
	for (i=0;i<this.projects.length;++i) {									// For each project
		layoutObj.Init(this.projects[i],tempObj.templates[curTemplate]);// Init layout
		}
	curProject=Math.min(this.projects.length-1,0);							// Init on 1st project
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// DRAW
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


folio.prototype.Draw=function()											// DRAW PAGE
{
	var h=window.innerHeight;												// Get height
	var w=window.innerWidth;												// Get width
	$("#bodyDiv").height(h-54);												// Set body height
	sf.DrawMenu();															// Set menu
	sf.DrawBody();															// Draw body
	sf.AddProjectItems();													// Add project items
	$("#projectDiv").height(h-78);											// Set project height
	$("#itemPickerDiv").height(h-90);										// Set picker height
	$("#itemPickerDiv").width(w-$("#projectDiv").width()-$("#galleryDiv").width()-92);					// Set picker width 
	$("#itemPickerDiv").css("left",$("#projectDiv").width()+$("#projectDiv").offset().left+16+"px");	// Set picker left 
	if (curMenu == "project")												// If a project
 		sf.AddProjectHandlers();											// Add project handlers
	else if (curMenu == "page")												// If a page
		sf.AddPageHandlers();												// Add page handlers
	else if (curMenu == "item")												// If item
 		itemObj.AddHandlers();												// Add item handlers
}
		
folio.prototype.DrawMenu=function()										// DRAW MENU AREA
{
	$('[id$="Menu"]').css("color","#000");									// Reset
	$("#editDiv").remove();													// Kill edit menu if left open
	var str="<b>"+this.firstName+" "+this.lastName+"</b>";					// Add name
	if (curMenu == "project")	{											// If project
		$("#projectMenu").css("color","#00aa00");							// Highlight it
		str+=" &nbsp;|&nbsp; ";												// Add to breadcrumb
		if ((curProject != -1) && this.projects[curProject].title)			// A valid project
			str+=ShortenString(this.projects[curProject].title,20);			// Add title
		}
	else if (curMenu == "page") {											// If page
		$("#pageMenu").css("color","#00aa00");								// Highlight it
		str+="&nbsp;|&nbsp; ";												// Add to breadcrumb
		if ((curProject != -1) && this.projects[curProject].title)			// A valid project
			str+=ShortenString(this.projects[curProject].title,20);			// Add title
		str+=" &nbsp;|&nbsp; "+(curPage-0+1);								// Add to breadcrumb
		}
	else if (curMenu == "item") 											// If item
		$("#itemMenu").css("color","#00aa00");								// Highlight it
	else if (curMenu == "help") 											// If help
		$("#helpMenu").css("color","#00aa00");								// Highlight it
	$("#breadMenu").html(str);												// Set breadcrumb
}

folio.prototype.DrawBody=function()										// DRAW BODY AREA
{
	var str="";
	if (curMenu == "project") {												// If a project
		if ((curProject < 0) && this.projects.length)						// Nothing selected and something there
			curProject=0;													// Pick first one
		str+=this.MakeGallery();											// Add Gallery
		str+=this.MakeProjectPage();										// Add project page
		str+="<div id='itemPickerDiv' class='sf-itemsPicker'></div>";		// Item picker container
		}
	else if (curMenu == "page") {											// If page
		if ((curProject >= 0) &&(curPage < 0) && this.projects[curProject].pages.length)		// Nothing selected and something there
			curPage=0;														// Pick first one
		str+=this.MakeGallery();											// Add Gallery
		str+=this.MakePagePage();											// Add page page
		str+="<div id='itemPickerDiv' class='sf-itemsPicker'></div>";		// Item picker container
		}
	else if (curMenu == "help") {											// If help
		str+="<div id='projectDiv' class='sf-projectPage' style='left:0px;width:50%;min-width:500px'>";	// Project container
		str+="<iframe frameborder='0' height='"+(window.innerHeight-90)+"' width='100%' src='";
		str+="//docs.google.com/document/d/1IEtDo0jMhtaVyFeewcB_UXHWirO2Al_jO6Ri7u1QYoI/pub?embedded=true'/></div>";
		}
	else if (curMenu == "edit") {											// If edit
		str+="<div id='projectDiv' class='sf-projectPage' style='left:0px;width:50%;min-width:500px'>";	// Project container
		}
	else if (curMenu == "item") 											// If item
		str+=itemObj.MakePage();											// Add item page
	$("#bodyDiv").html(str);												// Fill body
}
	
folio.prototype.MakeGallery=function()									// MAKE GALLERY 
{
	var i,o,n=0;labs=[];
	var h=$("#bodyDiv").height()-60;										// Get height											
	var trsty=" onMouseOver='this.style.backgroundColor=\"#dee7f1\"' ";		// Hover style
	trsty+="onMouseOut='this.style.backgroundColor=\"#f8f8f8\"'";
	var title=(curMenu == "project") ? "Portfolios" : "Pages";				// Set title
	var str="<div id='galleryDiv' class='sf-gallery'><p><b>"+title+"</b></p>";	// Make gallery div
	str+="<div class='sf-galleryContent' style='height:"+(h-20)+"px'>";		// Scrollable container

	if (curMenu == "project") {												// Project gallery
		if (!this.projects.length)											// No projects yet
			str+="<br>Add a new portfolio by clicking on the + icon below";	// Say so
		for (i=0;i<this.projects.length;++i) {								// For each project
			labs[i]=this.projects[i].title;									// Set label
			str+="<div id='galleryLab"+i+"'"+trsty+" class='sf-galleryLab'><span";
			if (i == curProject)											// If the current project
				str+=" style='color:#009900'"								// Color it
			str+=">"+labs[i]+"</span></div>";								// Close
			}
		}
	else if (curMenu == "page") {											// Page gallery
		if (curProject == -1) {												// No project selected yet
			str+="<br><br>Sorry, there is no portfolio selected yet.";		// Warn
			str+="<br><br>Go back to portfolios<br>and add one.";						
			return str+"</div>";											// Quit
			}
		o=this.projects[curProject].pages;									// Point at pages
		if (o)
			n=o.length;
		for (i=0;i<n;++i) {													// For each page
			str+="<div id='galleryLab"+i+"'"+trsty+" class='sf-galleryLab'><span";
			if (i == curPage)												// If the current project
				str+=" style='color:#009900'"								// Color it
			str+=">Page "+(i+1)+"</span></div>";							// Close
			}
		}
	str+="</div>";
	str+="<div style='position:relative;text-align:center;margin-top:8px'></div>";
	str+="<div class='sf-galleryTool'>";
	str+="<img id='galleryAddBut' class='sf-galleryBut' src='img/addbut.gif' title='Add new project'>";
	str+="<img id='galleryCopyBut' class='sf-galleryBut'src='img/copybut.gif'  title='Copy a project'>";
	str+="<img id='galleryTrashBut' class='sf-galleryBut' src='img/trashbut.gif' style='margin-right:0px' title='Remove a project'>";
	str+="</div></div>";
	return str;																// Return gallery
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// PROJECTS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	
folio.prototype.MakeProjectPage=function()								// MAKE PROJECT PAGE
{
	var i;
	var pTitle="",pDesc="",pCite="",pTags="",pCollab=[],pFormat="Booklet",pTemp="Full";
	var str="<div id='projectDiv' class='sf-projectPage'>";					// Project container
	if (curProject < 0) 													// No project selected
		return str+"</div>";												// Return empty page
	if (this.projects[curProject].title)  	pTitle=this.projects[curProject].title;
	if (this.projects[curProject].desc)   	pDesc=this.projects[curProject].desc;
	if (this.projects[curProject].cite)   	pCite=this.projects[curProject].cite;
	if (this.projects[curProject].tags)   	pTags=this.projects[curProject].tags;
	if (this.projects[curProject].format)   pFormat=this.projects[curProject].format;
	if (this.projects[curProject].temp)  	pTemp=this.projects[curProject].temp;
	if (this.projects[curProject].collab) 	pCollab=this.projects[curProject].collab.split(",");
	str+="<table style='width:100%;font-weight:bold;text-align:left'>";
	str+="<tr height='32'><td width='1%'>Title</td>";
	str+="<td><input class='sf-is' id='pTitle' ";
	str+="type='text' value='"+pTitle+"'></td></tr>";
	str+="<tr height='28'><td>Description</td><td><textarea class='sf-is' id='pDesc' ";
	str+="style='font-family:sans-serif'>"+pDesc+"</textarea></td></tr>";
	str+="<tr height='28'><td>Citation</td>";
	str+="<td><input class='sf-is' id='pCite' ";
	str+="type='text' value='"+pCite+"'></td></tr>";
	str+="<tr height='28'><td>Tags</td>";
	str+="<td><input class='sf-is' id='pTags' type='text' value='"+pTags+"'></td></tr>";
	str+="<tr height='28'><td>Collaborators&nbsp;&nbsp;&nbsp;</td>";
	str+="<td>"+MakeSelect("pCollab",false,pCollab);
	str+="<img id='collabAddBut' class='sf-galleryBut' src='img/addbut.gif' style='vertical-align:-4px;margin-left:16px;margin-right:8px' title='Add a new collaborator'>";
	str+="<img id='collabTrashBut' class='sf-galleryBut' src='img/trashbut.gif' style='vertical-align:-4px;margin-right:0px' title='Remove a collaborator'></td></tr>";
	str+="<tr height='28'><td>Format style</td><td>";
	str+=MakeSelect("pFormat",false,["Booklet","Single page","Canvas","Slide show","Up/Down"],pFormat)+"</td></tr>";
	str+="<tr height='28'><td>Template</td><td>";
	str+=MakeSelect("pTemp",false,["Default","Top & body","Custom"],pTemp);
	str+="<img id='tempAddBut' class='sf-galleryBut' src='img/addbut.gif' style='vertical-align:-4px;margin-left:16px;margin-right:8px' title='Add a new termplate'>";
	str+="<img id='tempTrashBut' class='sf-galleryBut' src='img/trashbut.gif' style='vertical-align:-4px;margin-right:0px' title='Remove a template'></td></tr>";
	str+="<tr height='50'><td colspan='2' style='text-align:center'>";
	str+="<button class='sf-bs' style='width:90px' id='addPages'>Add pages</button>&nbsp; &nbsp;";		// Add pages button
	str+="<button class='sf-bs' style='width:90px' id='setLayout'>Set layout</button>&nbsp; &nbsp;";	// Set layout button
	str+="<button class='sf-bs' style='width:90px' id='editPages'>Edit pages</button>&nbsp; &nbsp;";	// View pages button
	str+="<button class='sf-bs' style='width:90px' id='shareProject'>Share</button> </td></tr>";		// Share button
	str+="</table>";
	str+="<div id='projectItemsDiv' class='sf-projectItems'></div>";		// Items div
	return str+"</div>";													// Return project page
}

folio.prototype.AddProjectHandlers=function()							// ADD PROJECT HANDLERS
{

	$("#galleryAddBut").on("click",function() { 							// ADD NEW PROJECT
		sf.Do()																// Something changed
		sf.projects.push({ title:"New project", items:[] });				// Add shell					
		curProject=sf.projects.length-1;									// Point at it
		Sound("add");														// Add
		sf.Draw();															// Redraw
		});

	if (curProject < 0)														// If not a valid project										
			return;															// Quit
	
	this.AddProjectItems(true);												// Add project items
	
	$("#pTitle").on("change",function() { 									// If changed
		sf.Do()																// Something changed
		sf.projects[curProject].title=Escape($("#pTitle").val(),true);		// Set it	
		});
	
	$("#pDesc").on("change",function() { 									// If changed
		sf.Do()																// Something changed
		sf.projects[curProject].desc=Escape($("#pDesc").val(),true);		// Set it	
		});
	
	$("#pCite").on("change",function() { 									// If changed
		sf.Do()																// Something changed
		sf.projects[curProject].cite=Escape($("#pCite").val(),true);		// Set it	
		});
	
	$("#pTags").on("change",function() { 									// If changed
		sf.Do()																// Something changed
		sf.projects[curProject].tags=Escape($("#pTags").val(),true);		// Set it	
		});
	
	$("#pFormat").on("change",function() { 									// If changed
		sf.Do()																// Something changed
		sf.projects[curProject].format=$("#pFormat").val();					// Set it	
		Sound("click");														// Click
		sf.Draw();															// Redraw
		});
	
	$("#pTemp").on("change",function() { 									// If changed
		sf.Do()																// Something changed
		sf.projects[curProject].temp=$("#pTemp").val();						// Set it	
		Sound("click");														// Click
		sf.Draw();															// Redraw
		});

	for (i=0;i<sf.projects.length;++i)										// For each project
		$("#galleryLab"+i).on("click", function(e) {						// ON PROJECT CLICK
			curProject=e.currentTarget.id.substr(10)-0;						// Extract id
			Sound("click");													// Click
			sf.Draw();														// Redraw
			});

	$("#pFilter").on("change",function() { 									// If changed
		itemFilter=$("#pFilter").val();										// Set it	
		sf.Draw();															// Redraw
		});

	$("#pType").on("change",function() { 									// If changed
		itemType=$("#pType").val();											// Set it	
		sf.Draw();															// Redraw
		});
	
	$("#galleryCopyBut").on("click",function() { 							// COPY A PROJECT
		if (curProject < 0)													// If not a valid project										
			return;															// Quit
		GetTextBox("Type project name", "This is the name of the new project made from the current one", "", function(s) {	// Ask for name
			var o=JSON.stringify(sf.projects[curProject]);					// Deep copy current project as JSON
			sf.Do()															// Something changed
			sf.projects.push($.parseJSON(o));								// Add copy as object					
			curProject=sf.projects.length-1;								// Point at it
			sf.projects[sf.projects.length-1].title=s;						// Change title
			Sound("add");													// Add
			sf.Draw();														// Redraw
			});
		});
	
	$("#galleryTrashBut").on("click",function() { 							// DELETE PROJECT
		if (curProject < 0)													// If not a valid project										
			return;															// Quit
		ConfirmBox("This will delete the project:<br><br><b><i>"+sf.projects[curProject].title+"</b></i>", function() {
			sf.Do()															// Something changed
			sf.projects.splice(curProject,1);								// Remove it
			curProject--;													// Go to previous projcet
			Sound("delete");												// Delete
			sf.Draw();														// Redraw
			});
		});

	$("#collabAddBut").on("click",function() { 								// ADD NEW COLLABORATOR
		GetTextBox("Type name of collaborator", "", "", function(s) {		// Ask for name
			sf.Do()															// Something changed
			if (sf.projects[curProject].collab)								// If not first one
				sf.projects[curProject].collab+=","+s;						// Add new collaborator
			else															// Frist one one
				sf.projects[curProject].collab=s;							// Add first collaborator
			Sound("add");													// Add
			sf.Draw();														// Redraw
			$("#pCollab").val(s);
		});
	});

	$("#collabTrashBut").on("click",function() { 							// DELETE COLLABORATOR
			var s=$("#pCollab").val();
			if (!s)															// Nothing selected
				return;														// Quit
		ConfirmBox("This will delete  <b>"+s+" </b>from the project", function() {
			sf.Do()															// Something changed
			var v=sf.projects[curProject].collab.split(",");				// Make into array		
			v.splice($("#pCollab").prop('selectedIndex'),1);				// Delete it
			sf.projects[curProject].collab=v.toString();					// Combine into string
			Sound("delete");												// Delete
			sf.Draw();														// Redraw
			});
		});

	$("#tempAddBut").on("click",function() { 								// ADD NEW TEMPLATE
		GetTextBox("Type a short name of the new template", "This will create a new project template, based on the current one. [TBD]", "", function(s) {		// Ask for name
			sf.Do()															// Something changed
			Sound("add");													// Add
			sf.Draw();														// Redraw
			});
	});

	$("#tempTrashBut").on("click",function() { 								// DELETE TEMPLATE
			var s=$("#pTemp").val();										// Get current val
			if (!s)															// Nothing selected
				return;														// Quit
		ConfirmBox("This will delete the template named <b>"+s+" </b>from the project. [TBD]", function() {
			sf.Do()															// Something changed
			Sound("delete");												// Delete
			sf.Draw();														// Redraw
			});
		});

	$("#projectDiv").droppable({
		 drop: function(event, ui) {										// On drop
			if (ui.draggable.prop("id").substr(0,5)== "item-") {			// From items corpus
				sf.Do()													   	// Something changed
		 		sf.projects[curProject].items.push(ui.draggable.prop("id").substr(5));	// Add to items
				Sound("add");											 	// Add
				sf.AddProjectItems();								 	 	// Add project items
				}
			}
		 });
	
	$("#addPages").on("click",function() { 									// ADD PAGES
		var str="This will add a page for each item in the portfolio, in the order they are in now."
		str+="You can reorder and edit them in the Page editor.<br><br>";
		str+="<b>NOTE: </b>This will remove any pages you already have made!"
		ConfirmBox(str, function() {										// Confirm it
			sf.Do()															// Something changed
			sf.AddPages();													// Add pages
			curMenu="page";													// Set for page
			sf.Draw();														// Redraw
			});
		});

	$("#editPages").on("click",function() { 								// CREATE PAGES
		curMenu="page";														// Set for page
		Sound("click");														// Click
		sf.Draw();															// Redraw
		});

	$("#setLayout").on("click",function() { 								// SET LAYOUT
		sf.Do()																// Something changed
		layoutObj.Set(sf.projects[curProject],tempObj.templates[curTemplate]);	// Set layout
		});

	$("#shareProject").on("click",function() { 								// SHARE
		sf.Do()																// Something changed
		shareObj.Set(sf.projects[curProject]);								// Set share
		});
}	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// PAGES
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


folio.prototype.MakePagePage=function()									// MAKE PAGE PAGE
{
	var str="<div id='projectDiv' class='sf-projectPage' style='width:";	// Set project div
	str+=($("#bodyDiv").height()-50)*.75+"px'>";							// Set width
	if ((curProject < 0) || (curPage < 0))									// No project, page selected
		return str+"</div>";												// Return empty page
	var o=this.projects[curProject].pages[curPage];							// Point at page
	str+=playerObj.Make(editMode);											// Create divs for player
	str+="<div style='position:absolute;top:calc(100% - 45px);text-align:center'>";
	str+="<button class='sf-bs' id='setLayout'>Change this page's layout</button>&nbsp; &nbsp;";	// Set layout button
	str+="<input type='checkbox' id='editMode'"+(editMode ? " checked " : "")+"style='vertical-align:-3px'>Preview?";
	return str+"</div>";													// Return page page
}

folio.prototype.AddPageHandlers=function()								// ADD PAGE HANDLERS
{

	playerObj.Update(this.projects[curProject].pages[curPage],this.projects[curProject].layout);	// Add player obj
	
	for (var i=0;i<sf.projects[curProject].pages.length;++i)				// For each page
		$("#galleryLab"+i).on("click", function(e) {						// ON PAGE CLICK
			curPage=e.currentTarget.id.substr(10)-0;						// Extract id
			Sound("click");													// Click
			sf.Draw();														// Redraw
			});

	$("#galleryAddBut").on("click",function() { 							// ADD A PAGE
		if (curProject < 0)													// If not a valid project									
			return;															// Quit
		var p=sf.projects[curProject].pages;								// Point p at pages array
		sf.Do()																// Something changed
		p.push({ title:"New page"});										// Add page
		curPage=p.length-1;													// Point at it
		Sound("add");														// Add
		sf.Draw();															// Redraw
		});
	
	$("#galleryCopyBut").on("click",function() { 							// COPY A PAGE
		if ((curPage < 0) || (curProject < 0))								// If not a valid project/page										
			return;															// Quit
		var p=sf.projects[curProject].pages;								// Point p at pages
		sf.Do()																// Something changed
		p.push($.parseJSON(JSON.stringify(p[curPage])));					// Copy as object					
		curPage=p.length-1;													// Point at it
		Sound("add");														// Add
		sf.Draw();															// Redraw
		});
	
	$("#galleryTrashBut").on("click",function() { 							// DELETE PROJECT
		if ((curPage < 0) || (curProject < 0))								// If not a valid project/page										
			return;															// Quit
		ConfirmBox("This will delete this page", function() {				// Sure?
			sf.Do()															// Something changed
			var p=sf.projects[curProject].pages;							// Point p at pages
			p.splice(curPage,1);											// Remove it
			curPage--;														// Go to previous projcet
			Sound("delete");												// Delete
			sf.Draw();														// Redraw
			});
		});


	$("#setLayout").on("click",function() { 								// SET PAGE LAYOUT
		sf.Do()																// Something changed
		layoutObj.Set(sf.projects[curProject].pages[curPage],tempObj.templates[curTemplate],sf.Draw);	// Set layout
  		});

	$('[id^="playerPane"]').on("blur",function(e) { 						// EDIT PAGE PANE
		sf.Do()																// Something changed
		var p=sf.projects[curProject].pages[curPage];						// Point p at page
		var id=e.currentTarget.id.substr(10);								// Extract id
		p["markUp"+id]=$(this).html();										// Copy hlml contents of pane into page
   		});

	$("#editMode").on("click",function() { 									// SET PAGE LAYOUT
		editMode=!editMode;													// Toggle
		sf.Draw();															// Redraw
		});

}	

folio.prototype.AddPages=function()										// ADD PAGES TO PROJECT
{
	var i,j,o,p,po,str;
	paneNames=["Top","Left","Mid","Right","Bot"];							// Names of the panes
	this.Do();																// Something changed
	p=this.projects[curProject];											// Point p at project
	p.pages=[];																// Clear pages
	for (i=0;i<p.items.length;++i) {										// For each item in project
		str="";																// Assume nothing
		o=this.items[p.items[i]];											// Point at item			
		po={};																// New page object
		for (j=0;j<5;++j) {													// For each pane
			if (p.layout && (p.layout.panes[j].markUp != undefined))		// If a layout markup set for top
				po["markUp"+paneNames[j]]=p.layout.panes[j].markUp;			// Use it
			}		
		if (o.title) 														// If a title
			str+=StyleText(o.title,p.layout.panes[2].titleStyle); 			// Style text using middle pane setting
		if (o.src) {														// If a source
			str+="<br><div style='text-align:"+p.layout.itemAlign+"'>";		// Div for iframe	
			str+="<iframe frameborder='0' width='"+p.layout.itemWid+"' ";	// Width
			str+="style='border:"+p.layout.itemBorder+"' ";					// Border
			str+="src='"+o.src+"'></iframe></div>";							// Src
			}
		str+="<p>";															// Enclose in para
		if (o.desc) 														// If a desc
			str+=o.desc;													// Add it
		po.markUpMid+=str+"</p>";											// Add to markUp
		p.pages.push(po);													// Add page
		}
}

folio.prototype.AddProjectItems=function(showAll)						// ADD ITEMS
{
	var o,i,n,lab,pic,str,div;
	var fil="",typ="all types";
	if ((curMenu == "project") || (curMenu == "page")) {					// If filling project items
		if (curProject < 0)													// No project												
			return;															// Quit
		n=this.projects[curProject].items.length;							// Number of items
		}
	if (showAll) {
		typ=itemType.toLowerCase();											// Type as lc
		fil=itemFilter.toLowerCase();										// Filter as lc
		div="itemPickerDiv";												// Point at item picker
		str="<div style='text-align:center;margin-bottom:16px;'>Show only&nbsp;";			
		str+=MakeSelect("pType",false,["All types"].concat(itemObj.mediaTypeNames,itemType),itemType);
		str+="&nbsp; filtered&nbsp;by&nbsp;&nbsp;<input type='text' class='sf-is' id='pFilter' value='"+itemFilter+"' style='width:80px'> &nbsp;";
		str+="</div>"; 
		n=this.items.length;												// Number of items
		}
	else if (curMenu == "project") {										// Project page
		div="projectItemsDiv";												// Point at project items
		str="<p style='text-align:center'>Drag items to include in project here</p>";
		}
	else if (curMenu == "page") {											// Page page
		div="itemPickerDiv";												// Point at item picker
		str="<p style='text-align:center'>Portfolio items to use in pages</p>";
		}
	for (i=0;i<n;++i) {														// For each item
		pic=lab="";															// Clear
		if (typ != "all types")												// If filtering by type
			if (this.items[i].type != typ)									// Not the right one
				continue;													// Skip it
		if (fil) {															// If filtering by text
			lab=this.items[i].title+this.items[i].desc+this.items[i].citation+this.items[i].tags;	// Get certain fields
			if (lab.toLowerCase().indexOf(fil) == -1) 						// If not in there
				continue;													// Skip it
			}
		if (showAll) {														// Showing all items
			o=this.items[i];												// Point at items directly
			str+="<div id='item-"+i+"' class='sf-item'>";					// Add item container for items
			}
		else{																// Show only project items
			o=this.items[this.projects[curProject].items[i]];				// Point at item via project
			str+="<div id='pitem-"+i+"' class='sf-pitem'>";					// Add item container for pitems
			}
		if (o.title)														// If a title
			lab=ShortenString(o.title,35);									// Add it
		if (o.thumb)														// If a thumb
			pic=o.thumb;													// Add it
		else																// Use generic images
			pic=GetMediaIcon(o.type,o.src);									// Get icon
		str+="<img src='"+pic+"' class='sf-itemPic'>"+lab+"</div>";			// Add pic	
		}
	$("#"+div).html(str);													// Add items to div
	
	if ((curMenu == "project") || (curMenu == "page")) 						// If filling project items
		for (i=0;i<n;++i) {													// For each item in project

			$("#pitem-"+i).off("dblclick");	 								// Remove dblclick handlers
			$("#pitem-"+i).off("doubletap");	 							// Remove doubletap handlers

			$("#pitem-"+i).draggable({ 										// Make item draggable
				helper:'clone',appendTo:'body',			 					// Beyond parent frame
				stop: function(e, ui) {										// On stop dragging
					if ((curMenu == "project") && ((ui.position.left > 600) || (ui.position.left < 100))) {	// Out of project items box
						sf.Do()												// Something changed
				 		sf.projects[curProject].items.splice(e.target.id.substr(6),1);	// Remove it
						Sound("delete");									// Delete
						sf.AddProjectItems();								// Add project items
						}
					}
				});
				
			$("#pitem-"+i).droppable({ 										// Make item droppable
				 accept: ".sf-pitem",										// Accept only project items
				 drop: function(event, ui) {								// On drop
					var from=ui.draggable.prop('id').substr(6);				// Get id of dragged item
					var to=$(event.target).prop('id').substr(6);			// Get id of receiver item
					if (curMenu == "project") {								// Project
						sf.Do()												// Something changed
						var o=sf.projects[curProject].items;				// Point at items
						var t=o[to];										// Save to item
						o[to]=o[from];										// Copy from -> to
						o[from]=t;											// Reset to
						Sound("click");										// Click
						sf.AddProjectItems();								// Add project items
						}
					}
				 });

			$("#pitem-"+i).on("dblclick",function() {						// ON DOUBLE CLICK
				var id=$(this).prop("id").substr(6);						// Get id of project item
					itemObj.Preview(sf.projects[curProject].items[id]);		// Preview		
				});

			$("#pitem-"+i).on("doubletap",function() {						// ON DOUBLE CLICK MOBILE
				var id=$(this).prop("id").substr(6);						// Get id of project item
					itemObj.Preview(sf.projects[curProject].items[id]);		// Preview		
				});
			}

		if (showAll) {														// Showing all items
			for (i=0;i<n;++i) {												// For each item
				
				$("#item-"+i).on("dblclick",function() {					// ON DOUBLE CLICK
					itemObj.Preview($(this).prop("id").substr(5));			// Preview		
					});
				$("#item-"+i).on("doubletap",function() {					// ON DOUBLE CLICK MOBILE
					itemObj.Preview($(this).prop("id").substr(5));			// Preview		
					});
				
				$("#item-"+i).draggable({ 									// Make item draggable
					helper:'clone',appendTo:'body'			 				// Beyond parent frame
					});
				
				}
			}
}	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// UNDO
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

folio.prototype.Do=function()											// DO
{
	changed=true;															// Set change flag
}
	
	
</script>
</body>
</html>
	
